{"_id":"065W93lMtz6O4hGQ","name":"Shocking Grasp","type":"script","author":"DPSwXpPVU8d93GBw","img":"modules/plutonium/media/icon/spell/phb-shocking-grasp.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Shocking Grasp\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.0bImZ3m8zjOD6L3z"}}}
{"_id":"0usINzXxrd5UbBZU","name":"Set Elevation","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/mountain.svg","scope":"global","command":"let applyChanges = false;\n\nif(args && args.length>0){\nconsole.log(args);\n  let enterval=parseFloat(args[0]);\n  let exitval= args.length>1?parseFloat(args[1]):null;\n  let elevation=0;\n  if(event && event === MLT.ENTER)\n    elevation = enterval;\n  else if(event ** event === MLT.LEAVE)\n    elevation = exitval;\n    token.update({\n        \"elevation\": elevation\n    });\n}\nelse\n{\n    new Dialog({\n    title: `Token Elevation Changer`,\n    content: `\n      <form>\n        <div class=\"form-group\">\n          <label>Elevation Value:</label>\n          <input id=\"token-elevation\" name=\"token-elevation\" type=\"number\" step=\"1\" value=\"0\"/>\n        </div>\n      </form>\n      `,\n    buttons: {\n      yes: {\n        icon: \"<i class='fas fa-check'></i>\",\n        label: `Apply Changes`,\n        callback: () => applyChanges = true\n      },\n      no: {\n        icon: \"<i class='fas fa-times'></i>\",\n        label: `Cancel Changes`\n      },\n    },\n    default: \"yes\",\n    close: html => {\n      if (applyChanges) {\n        for ( let token of canvas.tokens.controlled ) {\n        let elevation = html.find('[name=\"token-elevation\"]')[0].value || \"0\";\n        token.update({\n            \"elevation\": parseFloat(elevation)\n        });\n        //token.data.elevation=parseInt(elevation);\n\n        }\n      }\n    }\n  }).render(true);\n}","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"core":{"sourceId":"Macro.CpL3YgGgMfvubvuq"},"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000"}}}
{"_id":"1xTZIjLATP5IMWSn","name":"Mage Hand","type":"script","author":"DPSwXpPVU8d93GBw","img":"modules/plutonium/media/icon/spell/phb-mage-hand.webp","scope":"global","command":"// Dependencies: Sequencer, Warp Gate\nif ( canvas.templates.preview.children.length ) return;\nconst spell = actor?.items.find(i => i.name === \"Mage Hand\");\nconst spellActor = game.actors.getName(\"Mage Hand\");\nif ( !spell || !spellActor ) return ui.notifications.warn(\"Spell not found.\");\n\nwarpgate.crosshairs.show({\n\ticon: spellActor.img,\n\tinterval: -1,\n\trememberControlled: true\n},{\n\tshow: checkDistance\n});\n\nasync function checkDistance(crosshairs) {\n\tconst range = spell.data.data.range.value;\n\tconst unit = canvas.scene.data.gridUnits;\n\tlet crosshairsDistance = 0, counter = 0;\n\tif ( token ) {\n\t\twhile ( crosshairs.inFlight && counter < 600 ) {\n\t\t\tcounter++;\n\t\t\tawait warpgate.wait(100);\t// Wait for initial render and delay loop\n\t\t\tconst ray = new Ray(token.center, crosshairs);\n\t\t\tconst distance = canvas.grid.measureDistances([{ray}], {gridSpaces: true});\n\t\t\tif ( distance !== crosshairsDistance ) {\n\t\t\t\tcrosshairsDistance = distance;\n\t\t\t\tcrosshairs.label = `${distance} ${unit}`;\n\t\t\t\tif ( distance > range ) crosshairs.icon = \"icons/svg/hazard.svg\";\n\t\t\t\telse crosshairs.icon = spellActor.img;\n\t\t\t\tcrosshairs.draw();\n\t\t\t}\n\t\t}\n\t} else {\n\t\twhile ( crosshairs.inFlight && counter < 600 ) {\n\t\t\tcounter++;\n\t\t\tawait warpgate.wait(100);\n\t\t}\n\t}\n\tif ( counter >= 600 ) crosshairs.inFlight = false;\n\tif ( crosshairs.cancelled ) return;\n\tif ( crosshairsDistance > range ) return ui.notifications.warn(\"Out of spell range.\");\n\tspell.roll();\n\tnew Sequence()\n\t\t.effect()\n\t\t\t.file(\"jb2a.swirling_sparkles.01.blue\")\n\t\t\t.atLocation(crosshairs)\n\t\t\t.scale(0.5)\n\t\t.wait(2400)\n\t\t.thenDo(() => warpgate.spawnAt(crosshairs, \"Mage Hand\"))\n\t\t.play();\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.JitK8YCakH7Yt97Z"}}}
{"_id":"3lPu5GgdgBIrOO6M","name":"Misty Step","type":"script","author":"DPSwXpPVU8d93GBw","img":"modules/plutonium/media/icon/spell/phb-misty-step.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Misty Step\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.79SNkqjZKmiysTJX"}}}
{"_id":"5DLNQnqE5Krx5DBU","name":"#[CF_tempEntity]","type":"chat","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"cf":{"id":"temp_3rrfyxwmoc3","path":"Player Macros","color":"#e4950c","name":"Player Macros","children":["YA5VKin92WkPPgec","BZYwgumMvcGa74sP","eGIxTwReGF3ITWKX","rPvuSeJV9GD4f0o7"],"folderPath":[]}}}
{"name":"UpdateTempHP","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/heal.svg","scope":"global","command":"let target = canvas.tokens.get(args[1]);\nif (!target) {\n  ChatMessage.create({content: `Token ${args[1]} is no longer in scene`, whisper: ChatMessage.getWhisperIDs(\"GM\")})\n  return;\n}\nlet increment = args[2];\nlet temphpMax = (target.actor.data.data.attributes.hp.tempmax < increment)? increment:target.actor.data.data.attributes.hp.tempmax;\nlet temphp = (target.actor.data.data.attributes.hp.tempmax < increment)? increment:target.actor.data.data.attributes.hp.temp;\n\nif (args[0] === \"on\") {\n  target.actor.update({\"data.attributes.hp.tempmax\": temphpMax, \"data.attributes.hp.temp\": temphp})\nChatMessage.create({content: `Meal: ${target.name} received ${increment} HP temp`})\n} else {\n  target.actor.update({\"data.attributes.hp.tempmax\": 0, \"data.attributes.hp.temp\": 0})\nChatMessage.create({content: `Meal Expiry: ${target.name} Temp HP reduced by 0`})\n}","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.scYvZN9M9svLXQpQ"}},"_id":"5bl99S0mf8q6keOO"}
{"_id":"6jG3KWJBGFYrRyl1","name":"CUB-Conditions","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"let mapsetting = game.settings.get('combat-utility-belt', \"activeConditionMap\");\n\nmapsetting.forEach(element =>\n    {\n    element.activeEffect = game.items.getName(`CUB-${element.name}`)?.data.effects.contents[0];\n    }\n )\n\ngame.settings.set('combat-utility-belt', \"activeConditionMap\", mapsetting);","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000"}}}
{"_id":"7CXd9RpGVm5KqB0l","name":"Encounter","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/environment/wilderness/mine-interior-dungeon-door.webp","scope":"global","command":"let encounter = new InnocentiWorld.Encounters();\nlet tableName = `Encounter ${game.scenes.active.name}`\nawait encounter.RollTable(tableName)","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.YnoukCtSVrv8t8XZ"},"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000"}}}
{"name":"Actions","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"//game.macros.entities.find(i => i.name === 'GMActions').execute(game.user.id,token.id,...args);\nconsole.log(\"AAAAA\", args)\n\nlet checks = new Innocenti.Actions(game.user,token);\nchecks.Check(...args);","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.phR02tAbyeMZDESJ"}},"_id":"7qNAt7Vx40y63bd3"}
{"name":"Create Tables By Rarity","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"game.betterTables.createTableFromCompendium(\"Full Table Foods\",\n    \"dnd5e.items\",\n    //\"innocenti-worlds.item-foods\",\n    //\"dnd5e.spells\",\n    { weightPredicate: predicate }\n);\n\nfunction predicate(entity) {\n    //if(entity.type != \"loot\") return 0;\n    //if(entity.data.data.level != 9) return 0;\n    //if(entity.data.data.consumableType != \"food\") return 0;\n    //if(entity.data.data.rarity != \"Legendary\") return 0;\n    //if(entity.data.data.price != 1000) return 0;\n    //if(entity.data.data.source != \"Vegetable\") return 0;\n\nconsole.log(\"Name\", entity.name)\n    switch (entity.data.data.rarity) {\n        case \"Common\":\n            return 16;\n        case \"Uncommon\":\n            return 8;\n        case \"Rare\":\n            return 4;\n        case \"Very rare\":\n            return 2;\n        case \"Legendary\":\n            return 1;\n        default:\n            return 0;\n    }\n\n}","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"Create Tables By Rarity ","colour":"#ff0000","trigger":""}},"cf":{"id":"temp_1obgq4p2j0q","path":"Generators","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.5c6EJu8botD8BsOp"}},"_id":"8SuCNj9QC9hGayVa"}
{"_id":"9RmkB9ho3xMdKx3o","name":"ReduceTokenSize","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/degen.svg","scope":"global","command":"canvas.tokens.controlled.forEach(x=>{\n    x.update({ \"width\": 0.5, \"height\": 0.5 })\n});","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000"}}}
{"_id":"BMElmXejoBWuZFXn","name":"WeaponsDamages","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/skills/melee/sword-damaged-broken-red.webp","scope":"global","command":"let destroyOn = -5;\nlet setDamage = parseInt(args[1]) ?? -1\nlet listitem = _token.actor.items.filter(x=>x.type == \"weapon\" && x.data.data.properties?.mgc != true)\n.sort((a, b) => a.name.localeCompare(b.name))\n.map(x=>{\n    return `<option value=\"${x.uuid}\">${x.name}</option>`\n});\nlet formulario = \n    `<div>Personagem: ${_token.name} </div>\n    <div>\n        <label for=\"weapon\"> Seleciona a Arma:\n            <select id=\"weaponDamage\" name=\"weaponDamage\">\n            ${listitem}\n            </select>\n        </label>\n    </div>\n    <div>\n        <label for=\"weaponDamageNum\"> Dano:\n            <input id=\"weaponDamageNum\" name=\"weaponDamageNum\" type=\"number\" value=\"${setDamage}\"/>\n        </label>\n    <div>`;\nconsole.log(listitem.join(\"\"));\nlet dialog = new Dialog({\n    title: \"Danificar Armas\",\n    content: formulario,\n    buttons:{\n        one:{\n            icon:'<i class=\"fas fa-dice-d20\"></i>',\n            label:\"Usar\",\n            callback: async () => {\n                let wDamage = $(`#weaponDamageNum`).val();\n                let weapon = $(`#weaponDamage option:selected`).val();\n                let weaponName = $(`#weaponDamage option:selected`).text();\n                let itemWeapon = await MidiQOL.MQFromUuid(weapon);\n                let weaponFlag = itemWeapon.data.data.flags?.weapondamage?.hits ?? 0;\n                weaponFlag = parseInt(weaponFlag);\n                if(weaponFlag <= destroyOn){\n                    _token.actor.items.delete(itemWeapon.id);\n                    let chatData = {\n                    speaker: ChatMessage.getSpeaker(),\n                    content: `The Weapon: <strong>${weaponName}</strong> of ${_token.name} has destroyed`\n                };\n                ChatMessage.create(chatData, {});\n                    return;\n                }\n                weaponFlag += parseInt(wDamage);\n                let rDamage = itemWeapon.data.data?.damage?.parts;\n                let nDamage = [];\n                if (rDamage.length > 0) {\n                    for (var i = 0; i < rDamage.length; i++) {\n                        nDamage.push([\"(\" + rDamage[i][0] + \")\" + wDamage, rDamage[i][1]])\n                    }\n                    await itemWeapon.update({'data.damage.parts': nDamage,'data.flags.weapondamage.hits': weaponFlag});\n                }\n                let chatData = {\n                    speaker: ChatMessage.getSpeaker(),\n                    content: `The Weapon: <strong>${weaponName}</strong> of ${_token.name} took the <strong>${wDamage} </strong> penalty`\n                    \n                };\n                ChatMessage.create(chatData, {});\nconsole.log(\"SLE\", weaponFlag, itemWeapon.data.flags);\n                \n            }\n        }\n    }\n});\n\ndialog.render(true);","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"cf":{"id":"temp_9kjle51osdj","path":"DAE","color":"#800000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.mIMS1fQt9IE5UmtP"},"scene-packer":{"sourceId":"Macro.BMElmXejoBWuZFXn"}}}
{"_id":"BZYwgumMvcGa74sP","name":"Looting","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/commodities/currency/coins-patched-pouch-white.webp","scope":"global","command":"let action = new InnocentiLoot.Loot();\nawait action.Check();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"core":{"sourceId":"Macro.4EF55MrKqHBYzI0m"},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_3rrfyxwmoc3","path":"Player Macros","color":"#e4950c"}}}
{"name":"RollTable: Complications","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/magic/death/undead-skeleton-deformed-red.webp","scope":"global","command":"game.tables.getName(\"Complications\").draw();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/d20-grey.svg","tooltip":"RollTable: Complications","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_xfdoz5ftmj","path":"Roll Tables","color":"#008000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.HEbMljxKEOZBEgYp"}},"_id":"BhqHaKMvslpAL7L1"}
{"_id":"CuaAMZeWEXVHNyIb","name":"Fire Bolt","type":"script","author":"DPSwXpPVU8d93GBw","img":"modules/plutonium/media/icon/spell/phb-fire-bolt.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Fire Bolt\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.Pbw0ThZjW0bDMumQ"}}}
{"_id":"Dn9oTjYU7BhddS61","name":"Aganazzar's Scorcher","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/fire/beam-jet-stream-trails-orange.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Aganazzar's Scorcher\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.mz7bIVWb9auoJEbt"}}}
{"name":"RollTable: Orientation","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/tools/navigation/compass-brass-blue-red.webp","scope":"global","command":"game.tables.getName(\"Orientation\").draw();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/d20-grey.svg","tooltip":"RollTable: Orientation","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_xfdoz5ftmj","path":"Roll Tables","color":"#008000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.1rqDqtjNNPzhH73i"}},"_id":"FEa4l1WReAZAUbPf"}
{"name":"RollTable: Complications Research","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/sundries/books/book-embossed-gold-red.webp","scope":"global","command":"game.tables.getName(\"Complications Research\").draw();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/d20-grey.svg","tooltip":"RollTable: Research Complications","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_xfdoz5ftmj","path":"Roll Tables","color":"#008000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.GCmalnLgLekr0TXS"}},"_id":"FcGajGO8vzxC8cnJ"}
{"_id":"G4iliGOvAqXhtbIi","name":"#[CF_tempEntity]","type":"chat","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000","name":"Automação","children":["6jG3KWJBGFYrRyl1","7CXd9RpGVm5KqB0l","HuhWwmdWzEP05mQp","9RmkB9ho3xMdKx3o","VxbeYfX3C9V7x7I8","0usINzXxrd5UbBZU","ZKDvu595QoETNUPa","ScCK2dsiciIPcXMx"],"folderPath":[]}}}
{"_id":"HuhWwmdWzEP05mQp","name":"Give Money","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/commodities/currency/coins-plain-stack-gold.webp","scope":"global","command":"//Money Give/Remover\n\n(() => {\n\tlet targets = game.user.targets;\n\n\tlet targets_content = ``;\n\n\tfor (let target of targets) {\n\t\ttargets_content += `<img src=${target.data.img} width=\"50\" height=\"50\">`\n\t}\n\n\tlet dialog_content = `\n\t<div class = \"form-group\">\n\t\t<h1><img src=\"icons/commodities/currency/coins-plain-stack-gold.webp\" width=\"50px\" /> Golden Share</h1>\n\t\t<table style=\"width: 100%; text-align:center; border: 1px solid black\">\n\t\t  <tr>\n\t\t\t<thcolspan=\"2\">${targets_content}</th>\n\t\t  </tr>\n\t\t  <tr>\n\t\t\t<td><label for=\"pp\">Platnium<label></td>\n\t\t\t<td><input name=\"pp\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"></td>\n\t\t  </tr>\n\t\t  <tr>\n\t\t\t<td><label for=\"gp\">Gold    <label></td>\n\t\t\t<td><input name=\"gp\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"></td>\n\t\t  </tr>\n\t\t  <tr>\n\t\t\t<td><label for=\"ep\">Electrum<label></td>\n\t\t\t<td><input name=\"ep\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"></td>\n\t\t  </tr>\n\t\t  <tr>\n\t\t\t<td><label for=\"sp\">Silver  <label></td>\n\t\t\t<td><input name=\"sp\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"></td>\n\t\t  </tr>\n\t\t  <tr>\n\t\t\t<td><label for=\"cp\">Copper  <label></td>\n\t\t\t<td><input name=\"cp\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"></td>\n\t\t  </tr>\n\t\t</table>\n\t</div>`;\n\n\tnew Dialog({\n\t\tcontent: dialog_content,\n\t\tbuttons:\n\t\t{\n\t\t\tOk: { icon: ``, label: `Change Money.`, callback: (html) => changeMoney(targets, html) }\n\t\t}\n\t}).render(true);\n})();\n\nasync function changeMoney(targets, html) {\n\tlet difference_money = {\n\t\tpp: parseInt(html.find('[name=pp]')[0].value),\n\t\tgp: parseInt(html.find('[name=gp]')[0].value),\n\t\tep: parseInt(html.find('[name=ep]')[0].value),\n\t\tsp: parseInt(html.find('[name=sp]')[0].value),\n\t\tcp: parseInt(html.find('[name=cp]')[0].value)\n\t}\n\n\t//divide update_money based on # of targets\n\tdifference_money = divideValue(difference_money, targets.size);\n\n\t//get rid of \"extra\" stuff, display all names in header\n\tlet actor_content = ``;\n\tfor (let target of targets) { actor_content += `${target.actor.name}, `; }\n\n\tlet table_content = ``;\n\tfor (let key in difference_money) {\n\t\tif (difference_money[key] !== 0)\n\t\t\ttable_content += `<tr><td>${key} :</td><td>${difference_money[key]}</td></tr>`\n\t}\n\n\tlet content = `\n\t<h2><img src=\"icons/commodities/currency/coins-plain-stack-gold.webp\" width=\"50px\" /> Add Money</h2>\n\t<table style \"width: 100%; text-align:center; border: 1px solid black\">\n\t\t<tr>\n\t\t  <th colspan=\"2\">Money Change :</th>\n\t\t</tr>\n\t\t<tr>\n\t\t  <th colspan=\"2\">${actor_content}</th>\n\t\t</tr>\n\t\t${table_content}\n\t</table>`;\n\n\tfor (let target of targets) {\n\t\tlet original_money = duplicate(target.actor.data.data.currency);\n\t\tlet update_money = changeValue(original_money, difference_money);\n\n\t\tawait target.actor.update({ \"data.currency\": update_money });\n\t}\n\n\tChatMessage.create({ content, speaker: ChatMessage._getSpeakerFromUser({ user: game.user }) })\n}\n\nfunction changeValue(Original, Difference) {\n\tlet Update = { pp: 0, gp: 0, ep: 0, sp: 0, cp: 0 };\n\n\tfor (let key in Original) {\n\t\tUpdate[key] = Original[key] + Difference[key];\n\t\tif (Update[key] < 0) {\n\t\t\tswitch (key) {\n\t\t\t\tcase \"cp\":\n\t\t\t\t\tif (Update[\"sp\"] > 0) {\n\t\t\t\t\t\tUpdate[\"cp\"] += 10;\n\t\t\t\t\t\tUpdate[\"sp\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"ep\"] > 0) {\n\t\t\t\t\t\tUpdate[\"cp\"] += 50;\n\t\t\t\t\t\tUpdate[\"ep\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"gp\"] > 0) {\n\t\t\t\t\t\tUpdate[\"cp\"] += 100;\n\t\t\t\t\t\tUpdate[\"gp\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"pp\"] > 0) {\n\t\t\t\t\t\tUpdate[\"cp\"] += 1000;\n\t\t\t\t\t\tUpdate[\"pp\"] -= 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(`Not enough money to do that.`);\n\t\t\t\t\t}\n\t\t\t\t\tUpdate = changeValue(Update, { pp: 0, gp: 0, ep: 0, sp: 0, cp: 0 });\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"sp\":\n\t\t\t\t\tif (Update[\"ep\"] > 0) {\n\t\t\t\t\t\tUpdate[\"sp\"] += 5;\n\t\t\t\t\t\tUpdate[\"ep\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"gp\"] > 0) {\n\t\t\t\t\t\tUpdate[\"sp\"] += 10;\n\t\t\t\t\t\tUpdate[\"gp\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"pp\"] > 0) {\n\t\t\t\t\t\tUpdate[\"sp\"] += 100;\n\t\t\t\t\t\tUpdate[\"pp\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"cp\"] > 9) {\n\t\t\t\t\t\tUpdate[\"sp\"] += 1;\n\t\t\t\t\t\tUpdate[\"cp\"] -= 10;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(`Not enough money to do that.`);\n\t\t\t\t\t}\n\t\t\t\t\tUpdate = changeValue(Update, { pp: 0, gp: 0, ep: 0, sp: 0, cp: 0 });\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"ep\":\n\t\t\t\t\tif (Update[\"gp\"] > 0) {\n\t\t\t\t\t\tUpdate[\"ep\"] += 2;\n\t\t\t\t\t\tUpdate[\"gp\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"pp\"] > 0) {\n\t\t\t\t\t\tUpdate[\"ep\"] += 20;\n\t\t\t\t\t\tUpdate[\"pp\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"sp\"] > 4) {\n\t\t\t\t\t\tUpdate[\"ep\"] += 1;\n\t\t\t\t\t\tUpdate[\"sp\"] -= 5;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"cp\"] > 49) {\n\t\t\t\t\t\tUpdate[\"ep\"] += 1;\n\t\t\t\t\t\tUpdate[\"cp\"] -= 50;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(`Not enough money to do that.`);\n\t\t\t\t\t}\n\t\t\t\t\tUpdate = changeValue(Update, { pp: 0, gp: 0, ep: 0, sp: 0, cp: 0 });\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"gp\":\n\t\t\t\t\tif (Update[\"pp\"] > 0) {\n\t\t\t\t\t\tUpdate[\"gp\"] += 10;\n\t\t\t\t\t\tUpdate[\"pp\"] -= 1;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"ep\"] > 1) {\n\t\t\t\t\t\tUpdate[\"gp\"] += 1;\n\t\t\t\t\t\tUpdate[\"ep\"] -= 2;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"sp\"] > 9) {\n\t\t\t\t\t\tUpdate[\"gp\"] += 1;\n\t\t\t\t\t\tUpdate[\"sp\"] -= 10;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"cp\"] > 99) {\n\t\t\t\t\t\tUpdate[\"gp\"] += 1;\n\t\t\t\t\t\tUpdate[\"cp\"] -= 100;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(`Not enough money to do that.`);\n\t\t\t\t\t}\n\t\t\t\t\tUpdate = changeValue(Update, { pp: 0, gp: 0, ep: 0, sp: 0, cp: 0 });\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"pp\":\n\t\t\t\t\tif (Update[\"gp\"] > 9) {\n\t\t\t\t\t\tUpdate[\"pp\"] += 1;\n\t\t\t\t\t\tUpdate[\"gp\"] -= 10;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"ep\"] > 19) {\n\t\t\t\t\t\tUpdate[\"pp\"] += 1;\n\t\t\t\t\t\tUpdate[\"ep\"] -= 20;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"sp\"] > 99) {\n\t\t\t\t\t\tUpdate[\"pp\"] += 1;\n\t\t\t\t\t\tUpdate[\"sp\"] -= 100;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Update[\"cp\"] > 999) {\n\t\t\t\t\t\tUpdate[\"pp\"] += 1;\n\t\t\t\t\t\tUpdate[\"cp\"] -= 1000;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(`Not enough money to do that.`);\n\t\t\t\t\t}\n\t\t\t\t\tUpdate = changeValue(Update, { pp: 0, gp: 0, ep: 0, sp: 0, cp: 0 });\n\t\t\t}\n\t\t}\n\t}\n\treturn Update;\n}\n\nfunction divideValue(Object, Value) {\n\tif (Value === 1) return Object;\n\tlet remainder = 0;\n\tlet Update = { pp: 0, gp: 0, ep: 0, sp: 0, cp: 0, remainder: 0 };\n\n\tfor (let key in Object) {\n\t\tUpdate[key] = Object[key] + remainder;\n\t\tremainder = Object[key] % Value;\n\t\tif (Update[key] > 0) Update[key] = Math.floor(Update[key] / Value);\n\t\tif (Update[key] < 0) Update[key] = Math.ceil(Update[key] / Value);\n\t\tif (remainder !== 0) {\n\t\t\tif (key === \"ep\") { remainder *= 5; }\n\t\t\telse if (key === \"gp\") { remainder *= 2; }\n\t\t\telse { remainder *= 10; }\n\t\t}\n\t}\n\tUpdate.remainder = remainder / 10;\n\treturn Update;\n}","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.HI20CS5Fh4z0goab"}}}
{"_id":"IRB5eRgch9FhO7OU","name":"Minor Illusion 1","type":"script","author":"DPSwXpPVU8d93GBw","img":"modules/plutonium/media/icon/spell/phb-minor-illusion.webp","scope":"global","command":"// Dependencies: Advanced Macros, Midi QoL, Sequencer, Token Magic FX, Warp Gate\n// Required settings: Execute Macro As GM, On Use Macro\nif ( canvas.templates.preview.children.length ) return;\nconst spell = actor?.items.find(i => i.name === \"Minor Illusion\");\nif ( !spell ) return ui.notifications.warn(\"Spell not found.\");\n\nconst title = \"Minor Illusion: Image Selection\";\nconst illusions = [\n\t{name: \"Generic\", img: \"upload-player/feanor/minor-illusion/generic.webp\"},\n\t{name: \"Bush\", img: \"upload-player/feanor/minor-illusion/bush.webp\"},\n\t{name: \"Crate\", img: \"upload-player/feanor/minor-illusion/crate.webp\"},\n\t{name: \"Door\", img: \"upload-player/feanor/minor-illusion/door.webp\"},\n\t{name: \"Rock\", img: \"upload-player/feanor/minor-illusion/rock.webp\"},\n\t{name: \"Sack\", img: \"upload-player/feanor/minor-illusion/sack.webp\"},\n\t{name: \"Treasure Chest\", img: \"upload-player/feanor/minor-illusion/treasure-chest.webp\"},\n\t{name: \"Treasure Pile\", img: \"upload-player/feanor/minor-illusion/treasure-pile.webp\"}\n];\nconst content = `<form class=\"flexrow\" style=\"margin:0 0 5px 0\">\n\t\t\t\t\t<div style=\"display:inline-flex; justify-content:flex-end; align-items:center; padding-right:10px\">\n\t\t\t\t\t\t<input type=\"checkbox\" id=\"overhead\">\n\t\t\t\t\t\t<label>Is Overhead?</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style=\"display:inline-flex; justify-content:flex-start; align-items:center; padding-left:10px\">\n\t\t\t\t\t\t<input type=\"checkbox\" id=\"filter\">\n\t\t\t\t\t\t<label>Has Filter?</label>\n\t\t\t\t\t</div>\n\t\t\t\t</form>`\n\nfunction buttonDialog() {\n\treturn new Promise(resolve => {\n\t\tconst buttons = {};\n\t\tillusions.forEach(illusion => {\n\t\t\tbuttons[illusion.name] = {\n\t\t\t\tlabel: `<img src=\"${illusion.img}\" style=\"border:0; max-height:70%\"><b>${illusion.name}</b>`,\n\t\t\t\tcallback: html => {\n\t\t\t\t\tconst isOverhead = html[0].querySelector(\"#overhead\").checked;\n\t\t\t\t\tconst hasFilter = html[0].querySelector(\"#filter\").checked;\n\t\t\t\t\tresolve({illusion: illusion.img, isOverhead, hasFilter});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tnew Dialog({title, content, buttons, default:\"Generic\",\n\t\t\trender: html => {\n\t\t\t\thtml.find(\"#overhead\").prop(\"checked\", spell.data.flags.world.castingChoices.isOverhead);\n\t\t\t\thtml.find(\"#filter\").prop(\"checked\", spell.data.flags.world.castingChoices.hasFilter);\n\t\t\t\thtml.find(\"input\").on(\"focus\", function(){$(this).css({\"box-shadow\": \"0 0 5px red\"})});\n\t\t\t\thtml.find(\"input\").on(\"focusout\", function(){$(this).css({\"box-shadow\": \"unset\"})});\n\t\t\t\thtml.find(\"button\").css({margin:0, \"max-width\":\"25%\", height:150, flex:\"0 0 auto\"});\n\t\t\t\thtml.find(\"#overhead\").focus();\n\t\t\t},\n\t\t\tclose: () => resolve(false)\n\t\t},{width:500}).render(true);\n\t});\n}\n\nlet selected = await buttonDialog();\nif ( !selected ) return;\nwarpgate.crosshairs.show({\n\ticon: selected.illusion,\n\tinterval: -1,\n\trememberControlled: true\n},{\n\tshow: checkDistance\n});\n\nasync function checkDistance(crosshairs) {\n\tconst range = spell.data.data.range.value;\n\tconst unit = canvas.scene.data.gridUnits;\n\tlet crosshairsDistance = 0, counter = 0;\n\tif ( token ) {\n\t\twhile ( crosshairs.inFlight && counter < 600 ) {\n\t\t\tcounter++;\n\t\t\tawait warpgate.wait(100);\t// Wait for initial render and delay loop\n\t\t\tconst ray = new Ray(token.center, crosshairs);\n\t\t\tconst distance = canvas.grid.measureDistances([{ray}], {gridSpaces: true});\n\t\t\tif ( distance !== crosshairsDistance ) {\n\t\t\t\tcrosshairsDistance = distance;\n\t\t\t\tcrosshairs.label = `${distance} ${unit}`;\n\t\t\t\tif ( distance > range ) crosshairs.icon = \"icons/svg/hazard.svg\";\n\t\t\t\telse crosshairs.icon = selected.illusion;\n\t\t\t\tcrosshairs.draw();\n\t\t\t}\n\t\t}\n\t} else {\n\t\twhile ( crosshairs.inFlight && counter < 600 ) {\n\t\t\tcounter++;\n\t\t\tawait warpgate.wait(100);\n\t\t}\n\t}\n\tif ( counter >= 600 ) crosshairs.inFlight = false;\n\tif ( crosshairs.cancelled ) return;\n\tif ( crosshairsDistance > range ) return ui.notifications.warn(\"Out of spell range.\");\n\tselected.location = crosshairs.center;\n\tawait spell.setFlag(\"world\", \"castingChoices\", selected);\n\tspell.roll();\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.iompENkOybhbSYZ8"}}}
{"name":"CheckItem","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"let checks = new Innocenti.CheckItem(game.user,token);\nchecks.Check(...args);","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.phR02tAbyeMZDESJ"}},"_id":"IuvO6w3YtJmjUGcf"}
{"name":"PoolCheck","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"//console.log(args);\nlet pool = new Innocenti.PoolCheck(game.user,token);\npool.Check(...args);","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.Ykra1KjpK4huzFoq"}},"_id":"JozN50QPQYV8A2i6"}
{"_id":"JwjhIHDCqdJXBLTl","name":"Melf's Minute Meteors Counter","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/fire/projectile-fireball-embers-yellow.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Melf's Minute Meteors Counter\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.EDMf40Zflc2rYyLM"}}}
{"name":"RollTable: Segredos dos Personagens","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/sundries/books/book-red-exclamation.webp","scope":"global","command":"game.tables.getName(\"Segredos dos Personagens\").draw();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_xfdoz5ftmj","path":"Roll Tables","color":"#008000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.O44VSFhNABFnWEKn"}},"_id":"L2xpqOpXYu6M2pQN"}
{"_id":"MuUxoMd1NiIizbm8","name":"Hypnotic Pattern 2","type":"script","author":"DPSwXpPVU8d93GBw","img":"systems/dnd5e/icons/spells/air-burst-magenta-2.jpg","scope":"global","command":"// Dependencies: Advanced Macros, Midi QoL, Sequencer, Token Magic FX\n// Required settings: Execute Macro As GM, On Use Macro\n// Issues: initial render bug; overhead tile flickering; radial occlusion get filters\nif ( args[0].tag === \"OnUse\" ) {\n\tconst grid = canvas.grid.size;\n\tconst template = canvas.templates.get(args[0].templateId);\n\tconst templateCenter = {x: template.x + grid * 3, y: template.y + grid * 3};\n\tconst tileData = {\n\t\timg: \"upload-player/feanor/hypnotic-pattern.webp\",\n\t\tx: template.x,\n\t\ty: template.y,\n\t\twidth: grid * 6,\n\t\theight: grid * 6,\n\t\toverhead: true,\n\t\tocclusion: {alpha: 0.5, mode: 1}\n\t};\n\tconst params = [{\n\t\tfilterType: \"glow\",\n\t\tfilterId: \"hypnoticPatternGlow\",\n\t\tcolor: 0x0bccfc,\n\t\touterStrength: 2,\n\t\tanimated: {\n\t\t\tcolor: {\n\t\t\t\tloopDuration: 5000,\n\t\t\t\tanimType: \"colorOscillation\",\n\t\t\t\tval1: 0x0bccfc,\n\t\t\t\tval2: 0xff57f7\n\t\t\t}\n\t\t}\n\t},{\n\t\tfilterType: \"distortion\",\n\t\tfilterId: \"hypnoticPatternDistortion\",\n\t\tanimated: {\n\t\t\tmaskSpriteX: {\n\t\t\t\tspeed: 0.05,\n\t\t\t\tanimType: \"move\"\n\t\t\t},\n\t\t\tmaskSpriteY: {\n\t\t\t\tspeed: 0.07,\n\t\t\t\tanimType: \"move\"\n\t\t\t}\n\t\t}\n\t},{\n\t\tfilterType: \"shadow\",\n\t\tfilterId: \"hypnoticPatternShadow\",\n\t\trotation: 45,\n\t\tdistance: 70,\n\t\talpha: 0.7,\n\t\tcolor: 0x033D4B,\n\t\tanimated: {\n\t\t\tblur: {\n\t\t\t\tloopDuration: 2000,\n\t\t\t\tanimType: \"cosOscillation\",\n\t\t\t\tval1: 1,\n\t\t\t\tval2: 5\n\t\t\t},\n\t\t\trotation: {\n\t\t\t\tloopDuration: 4000,\n\t\t\t\tanimType: \"sinOscillation\",\n\t\t\t\tval1: 40,\n\t\t\t\tval2: 50\n\t\t\t},\n\t\t\tcolor: {\n\t\t\t\tloopDuration: 5000,\n\t\t\t\tanimType: \"colorOscillation\",\n\t\t\t\tval1: 0x033D4B,\n\t\t\t\tval2: 0x4C1A4A\n\t\t\t}\n\t\t}\n\t}];\n\tawait new Sequence()\n\t\t.wait(200)\n\t\t.thenDo(() => template.document.delete())\n\t\t.effect()\n\t\t\t.file(\"jb2a.magic_signs.circle.02.illusion.intro.purple\")\n\t\t\t.scale(.75)\n\t\t\t.belowTokens()\n\t\t\t.atLocation(templateCenter)\n\t\t.wait(2600)\n\t\t.play();\n\tconst tile = await canvas.scene.createEmbeddedDocuments(\"Tile\", [tileData]);\n\tawait new Promise(r => setTimeout(r, 50)); // Wait for initial render to avoid error (see https://gitlab.com/foundrynet/foundryvtt/-/issues/6434)\n\tTokenMagic.addFilters(tile[0].object, params);\n\tawait new Promise(r => setTimeout(r, 4000));\t// Teaser saving throw delay\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"}}}
{"name":"Passive","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0].args){\n    let checks = new Innocenti.PassiveCheck(args[0].user.id,args[0].token);\n    checks.Check(...args[0].args);\n}else{\n    //args[0] = dificult\n    //args[1] = sucess\n    //args[2] = fail\n    //args[3] = flags\n   console.log(token.id,game.user.id,args);\n    console.log(args);\n    let checks = new Innocenti.PassiveCheck(game.user,token);\n    checks.Check(...args); \n}","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff"}},"_id":"Or6VL0dO08ZrSvU5"}
{"_id":"OtVoO7ApAQEZtwaO","name":"Shield","type":"script","author":"DPSwXpPVU8d93GBw","img":"modules/plutonium/media/icon/spell/phb-shield.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Shield\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.ziBzq6I5ARxC4YKX"}}}
{"name":"#[CF_tempEntity]","type":"chat","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"cf":{"id":"temp_xfdoz5ftmj","path":"Roll Tables","color":"#008000","name":"Roll Tables","children":["BhqHaKMvslpAL7L1","FcGajGO8vzxC8cnJ","FEa4l1WReAZAUbPf","L2xpqOpXYu6M2pQN"],"folderPath":[]}},"_id":"QFkO1jSZxCZceGxU"}
{"_id":"RTSGJs35AD36ukNe","name":"Elemental Affinity: Fire Damage Bonus","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/fire/flame-burning-fist-strike.webp","scope":"global","command":"const effect = actor?.effects.find(e => e.data.label === \"Fire Damage Bonus\");\nif ( !effect ) return ui.notifications.warn(\"Feature not found.\");\neffect.update({disabled: !effect.data.disabled});","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.pv89xQ26HodUOlKZ"}}}
{"_id":"ScCK2dsiciIPcXMx","name":"Update Unlinked Tokens to Actors","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"(async () => {\n    let aName = \"Bullywug\";\n    let tactor = game.actors.getName(aName);\n    let tokens = canvas.tokens.controlled;\n    for (var tok of canvas.tokens.controlled) {\n        tok.update({actorId: tactor._id})\n       console.log(tok)\n    }\n    \n})();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.egoPB0H7IIZFYlyA"}}}
{"_id":"UxcSRDbxN5i0yt2a","name":"ArmorDamages","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/skills/melee/shield-damaged-broken-brown.webp","scope":"global","command":"let destroyOn = 10;\nlet setDamage = parseInt(args[1]) ?? -1;\nlet listitem = _token.actor.items.filter(x=>x.type == \"equipment\" && x.data.data.properties?.mgc != true)\n.sort((a, b) => a.name.localeCompare(b.name))\n.map(x=>{\n    return `<option value=\"${x.uuid}\">${x.name}</option>`\n});\nlet formulario = \n    `<div>Personagem: ${_token.name} </div>\n    <div>\n        <label for=\"armorDamage\"> Seleciona a Arma:\n            <select id=\"armorDamage\" name=\"weaponDamage\">\n            ${listitem}\n            </select>\n        </label>\n    </div>\n    <div>\n        <label for=\"armorDamageNum\"> Dano:\n            <input id=\"armorDamageNum\" name=\"armorDamageNum\" type=\"number\" value=\"${setDamage}\"/>\n        </label>\n    <div>`;\nconsole.log(listitem.join(\"\"));\nlet dialog = new Dialog({\n    title: \"Danificar Armaduras\",\n    content: formulario,\n    buttons:{\n        one:{\n            icon:'<i class=\"fas fa-dice-d20\"></i>',\n            label:\"Usar\",\n            callback: async () => {\n                let aDamage = $(`#armorDamageNum`).val();\n                let armor = $(`#armorDamage option:selected`).val();\n                let armorName = $(`#armorDamage option:selected`).text();\n                let itemArmor = await MidiQOL.MQFromUuid(armor);\n                let armorValue = itemArmor.data.data.armor?.value ?? 11;\n                armorValue += parseInt(aDamage);\n                if(armorValue <= destroyOn){\n                    _token.actor.items.delete(itemArmor.id);\n                    let chatData = {\n                    speaker: ChatMessage.getSpeaker(),\n                    content: `The Armor: <strong>${armorName}</strong> of ${_token.name} has destroyed`\n                };\n                ChatMessage.create(chatData, {});\n                    return;\n                }\n                await itemArmor.update({'data.armor.value': armorValue});\n                let chatData = {\n                    speaker: ChatMessage.getSpeaker(),\n                    content: `The Weapon: <strong>${armorName}</strong> of ${_token.name} took the <strong>${aDamage} </strong> penalty`\n                    \n                };\n                ChatMessage.create(chatData, {});\n                \n            }\n        }\n    }\n});\n\ndialog.render(true);","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"cf":{"id":"temp_9kjle51osdj","path":"DAE","color":"#800000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.k9T83fD3ny2TvV2a"},"scene-packer":{"sourceId":"Macro.UxcSRDbxN5i0yt2a"}}}
{"_id":"VxbeYfX3C9V7x7I8","name":"SeeID","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"//Display Name & IDs\nfor(let token of canvas.tokens.controlled)\n{\n    ChatMessage.create({\n        content : token.name + \" \" + token.id\n    });\n}\n\nfor(let wall of canvas.walls.controlled)\n{\n    ChatMessage.create({\n        content : wall.name + \" \" + wall.id\n    })\n}\n/*\nfor(let light of canvas.lighting.activate)\n{\n    ChatMessage.create({\n        content : light.name + \" \" + light.id\n    })\n}\nfor (let note of canvas.notes.placeables)\n{\n    ChatMessage.create({\n        content :  note.name + \" \" + note.id\n     });\n}\n*/\nfor (let draw of canvas.drawings.controlled)\n{\n   ChatMessage.create({\n      content :  draw.name + \" \" + draw.id\n   });\n}\n\nfor (let tile of canvas.activeLayer.controlled)\n{\n    ChatMessage.create({\n        content :  tile.name + \" \" + tile.id\n     });\n}","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.MuNTG5b6wHoDpuUe"}}}
{"_id":"YA5VKin92WkPPgec","name":"Find Trap","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/skills/targeting/crosshair-ringed-gray.webp","scope":"global","command":"let actions = new InnocentiOpenLock.Actions('FindLockTrap');","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.4MODdS79QhACoEd9"},"furnace":{"runAsGM":false},"cf":{"id":"temp_3rrfyxwmoc3","path":"Player Macros","color":"#e4950c"},"advanced-macros":{"runAsGM":false}}}
{"_id":"Ye8CJeoMgOocfdCF","name":"Elemental Affinity: Fire Resistance","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/equipment/shield/heater-stone-orange.webp","scope":"global","command":"const feat = actor?.items.find(i => i.name === \"Elemental Affinity\");\nconst effect = actor?.effects.find(e => e.data.label === \"Fire Resistance\");\nconst resource = actor?.items.find(i => i.name === \"Sorcery Points\");\nif ( !feat || !effect || !resource ) return ui.notifications.warn(\"Feature not found.\");\nif ( effect.data.disabled ) {\n\tif ( resource.data.data.uses.value < 1 ) return ui.notifications.warn(\"Not enough sorcery points.\");\n\teffect.update({disabled: false});\n\tresource.update({\"data.uses.value\": resource.data.data.uses.value - 1});\n\tawait feat.roll();\n\tChatMessage.create({\n\t\tcontent: `<div class=\"dice-roll\">\n\t\t\t\t\t<div class=\"dice-formula\">Spent 1 SP</div>\n\t\t\t\t\t<div class=\"dice-formula\" style=\"margin:0\">Gained Fire Resistance (1 hour)</div>\n\t\t\t\t</div>`,\n\t\tspeaker: {alias: \"Fëanor - Elemental Affinity\"}\n\t});\n} else {\n\teffect.update({disabled: true});\n\tChatMessage.create({\n\t\tcontent: `<div class=\"dice-roll\"><div class=\"dice-formula\" style=\"margin:0\">Lost Fire Resistance</div></div>`,\n\t\tspeaker: {alias: \"Fëanor - Elemental Affinity\"}\n\t});\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.k0Biy0YZeSQVsmzB"}}}
{"_id":"ZKDvu595QoETNUPa","name":"Set Patrol","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"await canvas.tokens.controlled.forEach(x=>{\n    canvas.tokens.documentCollection.map(y=>{\n        if(y.uuid == x.document.uuid){\n            let patrol = y.getFlag(\"patrol\",\"enablePatrol\") ?? false;\n            let spoot = y.getFlag(\"patrol\",\"enableSpotting\") ?? false;\n            y.setFlag(\"patrol\",\"enablePatrol\", !patrol);\n            y.setFlag(\"patrol\",\"enableSpotting\", !spoot);\n           //console.log(\"Name\", patrol); \n        }\n    });\n    ui.notifications.info(\"Todos patrulhando\");\n});","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_ytj265j2gfr","path":"Automação","color":"#000000"}}}
{"name":"Slipy","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"let tactor = _token.actor;\nlet dificult = args[0]??10;\nlet actorTrap = game.actors.getName(\"Trap\");\nlet item = actorTrap.items.find(a => a.name === \"Slipy\");\nlet fitem = tactor.items.find(a => a.name === \"Grampos\" || a.name === \"Crampon\");\nif(!fitem){\n    tactor.rollSkill('acr').then((result) => {\n        if(result.total < dificult){\n            new MidiQOL.TrapWorkflow(actorTrap, item, [_token], _token.center);\n        }\n        \n    })\n}else{\n    ChatMessage.create({\n        user: ChatMessage.getWhisperRecipients(\"GM\")[0],\n        content: `${_token.name} - does not slip because he is using ${fitem.name}`,\n        speaker: ChatMessage.speaker,\n        //whisper: ChatMessage.getWhisperRecipients(\"GM\"),\n        blind: false\n    });\n}","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.qNdIEHjfavQHebE3"}},"_id":"bJFiyTFwdbqsuIkg"}
{"name":"Update Loot-Consumable","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"(async ()=>{\n    let changeFolder = 'Custom Foods';\n    let items = await game.items;\n    await items.map(x=>{\n        if(x.folder?.name == changeFolder ){\n          console.log(x.name);\n          x.update({type: 'consumable', 'data.consumableType': 'food', 'data.uses.autoDestroy': true});\n        }\n        \n    });\n    console.log(\"FIM\")\n})();\n\n\n\n\n    //await game.items.contents.map(item=>{\n        //if(item.name != null){\n        //console.log(item.folder.name)\n        //if(item.folder.name == changeFolder){\n           //console.log(\"Name\", item)\n        //item.update({type: 'consumable', 'data.consumableType': 'food', 'data.uses.autoDestroy': true});\n        //}\n        //}\n        \n    //})","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_1obgq4p2j0q","path":"Generators","color":"#000000"}},"_id":"cFmZEvLi38bkA8Xl"}
{"name":"#[CF_tempEntity]","type":"chat","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"cf":{"id":"temp_1obgq4p2j0q","path":"Generators","color":"#000000","name":"Generators","children":["8SuCNj9QC9hGayVa","sfwIdnImby8sxWfa","cFmZEvLi38bkA8Xl","pfamJ7hkUvTBrCzL"],"folderPath":[]}},"_id":"cFzAFU5QtDzReovb"}
{"_id":"dYTypZmWa1pZx6pl","name":"Random Push","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/skills/movement/arrow-upward-blue.webp","scope":"global","command":"const lastArg = args[args.length-1];\nlet target = MidiQOL.MQFromUuid(lastArg.tokenUuid)\n//console.log(\"ARGS\", args)\nif(args[0] == \"on\"){\n    let content = \"\";\n    let r = new Roll(\"1d8\");\n    await r.evaluate({async: true});\n    let dir = DirectionToken(r.total);\n    let chatData = {\n        speaker: ChatMessage.getSpeaker(),\n        content: `<p>${target.name} has pushed <strong>${args[1]}ft</strong> away in <strong><img src=\"assets/icons/arrows/${dir}.png\" width=\"15\"></strong></p>`\n    };\n    console.log(\"dir\", dir)\n    await ChatMessage.create(chatData, {});\n}\nfunction DirectionToken(result){\n    switch (result) {\n        case 1:\n            return \"north\"\n            break;\n        case 2:\n            return \"northeast\"\n            break;\n        case 3:\n            return \"east\"\n            break;\n        case 4:\n            return \"southeast\"\n            break;\n        case 5:\n            return \"south\"\n            break;\n        case 6:\n            return \"southwest\"\n            break;\n        case 7:\n            return \"west\"\n            break;\n        case 8:\n            return \"northwest\"\n            break;\n        \n        default:\n            // code\n    }\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_9kjle51osdj","path":"DAE","color":"#800000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.sUyvkun5YUI1P6i1"},"scene-packer":{"sourceId":"Macro.dYTypZmWa1pZx6pl"}}}
{"name":"PoolFlags","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"//console.log(token.id);\n//console.log(args)\nlet pool = new Innocenti.PoolFlags(token.id, ...args);\nif(event == 'leave') pool.remove = true;\npool.AddPool();\npool.RemovePool();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.o8zxazJfUPDgD8Bl"}},"_id":"dkpT9wpKh8ZICAd5"}
{"_id":"dsU5qKAwKxFjlhP0","name":"Melf's Minute Meteors","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/earth/projectiles-lava-salvo-orange.webp","scope":"global","command":"// Dependencies: Advanced Macros, Midi QoL (On Use Macro), Sequencer\nif ( !args.length ) game.dnd5e.rollItemMacro(\"Melf's Minute Meteors\");\nelse if ( args[0].tag === \"OnUse\" ) {\n\tawait new Sequence()\n\t\t.sound()\n\t\t\t.file(\"upload-player/feanor/melfs-minute-meteors_casting.wav\")\n\t\t.wait(4000)\n\t\t.play();\n\tconst level = args[0].spellLevel;\n\tconst quantity = 6 + (2 * (level - 3));\n\tChatMessage.create({\n\t\tcontent: `<div class=\"dice-roll\"><div class=\"dice-formula\" style=\"margin:0\">Created ${quantity} meteors</div></div>`,\n\t\tspeaker: {alias: \"Fëanor - Melf's Minute Meteors\"}\n\t});\n\tconst counter = actor.items.find(i => i.name === \"Melf's Minute Meteors Counter\");\n\tif ( !counter ) return ui.notifications.warn(\"Melf's Minute Meteors Counter not found.\");\n\tcounter.update({\"data.uses.value\": quantity, \"data.uses.max\": quantity});\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.j3v7fHi7TnyCxksG"}}}
{"name":"Open Door/Chest","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/sundries/misc/lock-open-yellow.webp","scope":"global","command":"let actions = new InnocentiOpenLock.Actions('OpenLock');","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.UXJLvaOUS8ANMPkp"},"furnace":{"runAsGM":false},"cf":{"id":"temp_3rrfyxwmoc3","path":"Player Macros","color":"#e4950c"}},"_id":"eGIxTwReGF3ITWKX"}
{"_id":"f92PqpCf4CSfTgAQ","name":"DAEDamage","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/skills/wounds/blood-spurt-spray-red.webp","scope":"global","command":"// DAEDamage damege type\nconst lastArg = args[args.length-1];\nlet atype = args[2]\nlet adamage = args[1]\nconsole.log(\"DAMAGE\", args)\nif (args[0] == \"on\") {\n    console.log(\"DAMAGE\", lastArg)\n    let ttoken = await fromUuid(lastArg.tokenUuid); // better since it gets the token no matter what scene it is on\n    let casterItem = await fromUuid(lastArg.origin); // better since it gets the item on the synthetic actor\n    let aactor = casterItem.actor;\n    if (aactor.uuid === lastArg.actorUuid) return; // don't trigger on the troll\n    let damageRoll = new Roll(adamage).roll({async:false});\n    console.log(\"DAMAGE\", ttoken)\n    new MidiQOL.DamageOnlyWorkflow(aactor,token,damageRoll.total,atype,[ttoken], damageRoll,{itemCardId: \"new\", itemData:casterItem.data});\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"cf":{"id":"temp_9kjle51osdj","path":"DAE","color":"#800000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.BZ6YM0xXTdzVvLey"},"scene-packer":{"sourceId":"Macro.f92PqpCf4CSfTgAQ"}}}
{"_id":"fXIqvXi5LZtk33px","name":"Flexible Casting","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/lightning/bolt-strike-explosion-yellow.webp","scope":"global","command":"const feat = actor?.items.find(i => i.name === \"Flexible Casting\");\nconst resource = actor?.items.find(i => i.name === \"Sorcery Points\");\nif ( !feat || !resource ) return ui.notifications.warn(\"Feature not found.\");\n\nconst spellLevels = [{name:\"1st level\",level:\"1\",s:\"selected\"},{name:\"2nd level\",level:\"2\",s:\"\"},{name:\"3rd level\",level:\"3\",s:\"\"}];\nconst options = spellLevels.reduce((acc, cur) => acc += `<option value=\"${cur.level}\" ${cur.s}>${cur.name}</option>`,\"\");\nconst content = `<form><div class=\"form-group\"><label>Spell Slot Level:</label><select>${options}</select></div></form>`;\n\nnew Dialog({\n\ttitle: \"Flexible Casting: Usage Configuration\",\n\tcontent,\n\tbuttons: {\n\t\tExpend: {\n\t\t\ticon: `<i class=\"fas fa-chevron-down\"></i>`,\n\t\t\tlabel: \"Expend Slot\",\n\t\t\tcallback: async html => {\n\t\t\t\tconst spellLevel = html.find(\"select\").val();\n\t\t\t\tconst slotLevel = parseInt(spellLevel);\n\t\t\t\tconst slotsAvailable = actor.data.data.spells[`spell${spellLevel}`].value;\n\t\t\t\tif ( slotsAvailable < 1 ) return ui.notifications.warn(\"No spell slots available.\");\n\t\t\t\tif ( resource.data.data.uses.value >= resource.data.data.uses.max ) return ui.notifications.warn(\"Impossible to gain more sorcery points.\");\n\t\t\t\tactor.update({[`data.spells.spell${spellLevel}.value`]: slotsAvailable - 1});\n\t\t\t\tresource.update({\"data.uses.value\": Math.min(resource.data.data.uses.value + slotLevel, resource.data.data.uses.max)});\n\t\t\t\tawait feat.roll();\n\t\t\t\tChatMessage.create({\n\t\t\t\t\tcontent: `<div class=\"dice-roll\">\n\t\t\t\t\t\t\t\t<div class=\"dice-formula\">Spent a Slot Level ${spellLevel}</div>\n\t\t\t\t\t\t\t\t<div class=\"dice-formula\" style=\"margin:0\">Gained ${spellLevel} SP</div>\n\t\t\t\t\t\t\t</div>`,\n\t\t\t\t\tspeaker: {alias: \"Fëanor - Converting Spell Slot to SP\"}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tCreate: {\n\t\t\ticon: `<i class=\"fas fa-chevron-up\"></i>`,\n\t\t\tlabel: \"Create Slot\",\n\t\t\tcallback: async html => {\n\t\t\t\tconst spellLevel = html.find(\"select\").val();\n\t\t\t\tconst slotLevel = parseInt(spellLevel);\n\t\t\t\tconst cost = slotLevel < 3 ? slotLevel + 1 : slotLevel + 2;\n\t\t\t\tconst slotsAvailable = actor.data.data.spells[`spell${spellLevel}`].value;\n\t\t\t\tif ( resource.data.data.uses.value < cost ) return ui.notifications.warn(\"Not enough sorcery points.\");\n\t\t\t\tresource.update({\"data.uses.value\": resource.data.data.uses.value - cost});\n\t\t\t\tactor.update({[`data.spells.spell${spellLevel}.value`]: slotsAvailable + 1});\n\t\t\t\tawait feat.roll();\n\t\t\t\tChatMessage.create({\n\t\t\t\t\tcontent: `<div class=\"dice-roll\">\n\t\t\t\t\t\t\t\t<div class=\"dice-formula\">Spent ${cost} SP</div>\n\t\t\t\t\t\t\t\t<div class=\"dice-formula\" style=\"margin:0\">Created a Slot Level ${spellLevel}</div>\n\t\t\t\t\t\t\t</div>`,\n\t\t\t\t\tspeaker: {alias: \"Fëanor - Creating Spell Slot\"}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\trender: html => html.find(\"select\").focus(),\n\tdefault: \"Create\"\n}).render(true);","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.MRwntP8m5wKRpDhr"}}}
{"_id":"fnytqhkDWoZsuLnR","name":"Ray of Frost","type":"script","author":"DPSwXpPVU8d93GBw","img":"modules/plutonium/media/icon/spell/phb-ray-of-frost.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Ray of Frost\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.WuM2kOBww4o4eU3W"}}}
{"name":"Checks","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"//args[0] = skill\n//args[1] = dificult\n//args[2] = sucess\n//args[3] = fail\n//args[4] = flags\n//console.log(token.id,game.user.id,args);\nconsole.log(args);\nlet checks = new Innocenti.Checks(game.user,token);\nchecks.Check(...args);","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.ksHWjfSLEJIPPbFA"}},"_id":"gNukDjiPOdBAEXU1"}
{"_id":"gPRCwFsdWrp1yPvg","name":"Metamagic: Twinned Spell","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/light/beams-explosion-blue.webp","scope":"global","command":"const feat = actor?.items.find(i => i.name === \"Metamagic: Twinned Spell\");\nconst resource = actor?.items.find(i => i.name === \"Sorcery Points\");\nif ( !feat || !resource ) return ui.notifications.warn(\"Feature not found.\");\n\nconst spellLevels = [{name:\"Cantrip\",level:\"0\",s:\"selected\"},{name:\"1st level\",level:\"1\",s:\"\"},{name:\"2nd level\",level:\"2\",s:\"\"},{name:\"3rd level\",level:\"3\",s:\"\"}];\nconst options = spellLevels.reduce((acc, cur) => acc += `<option value=\"${cur.level}\" ${cur.s}>${cur.name}</option>`,\"\");\nconst content = `<form><div class=\"form-group\"><label>Spell Level:</label><select>${options}</select></div></form>`;\n\nconst d = Dialog.prompt({\n\ttitle: \"Twinned Spell: Usage Configuration\",\n\tcontent,\n\tlabel: \"Twin\",\n\tcallback: async html => {\n\t\tconst level = html.find(\"select\").val();\n\t\tconst cost = parseInt(level) || 1;\n\t\tif ( resource.data.data.uses.value < cost ) return ui.notifications.warn(\"Not enough Sorcery Points.\");\n\t\tresource.update({\"data.uses.value\": resource.data.data.uses.value - cost});\n\t\tawait feat.roll();\n\t\tChatMessage.create({\n\t\t\tcontent: `<div class=\"dice-roll\">\n\t\t\t\t\t\t<div class=\"dice-formula\">Spent ${cost} SP</div>\n\t\t\t\t\t\t<div class=\"dice-formula\" style=\"margin:0\">Duplicated a ${level === \"0\" ? \"Cantrip\" : \"Spell Level \" + level}</div>\n\t\t\t\t\t</div>`,\n\t\t\tspeaker: {alias: \"Fëanor - Twinned Spell\"}\n\t\t});\n\t},\n\trender: html => html.find(\"select\").focus(),\n\trejectClose: false\n});","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.RXmbzOb1gItsWRMw"}}}
{"_id":"hCw0vktxH29Xoy48","name":"Chromatic Orb","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/symbols/elements-air-earth-fire-water.webp","scope":"global","command":"const spell = actor?.items.find(i => i.name === \"Chromatic Orb\");\nif ( !spell ) return ui.notifications.warn(\"Spell not found.\");\n\nlet damageTypes = [{name:\"Acid\",type:\"acid\"},{name:\"Cold\",type:\"cold\"},{name:\"Fire\",type:\"fire\"},{name:\"Lightning\",type:\"lightning\"},{name:\"Poison\",type:\"poison\"},{name:\"Thunder\",type:\"thunder\"}];\n\nconst currentDamageType = spell.data.data.damage.parts[0][1];\nconst index = damageTypes.findIndex(entry => entry.type === currentDamageType);\ndamageTypes[index].s = \"selected\";\n\nconst options = damageTypes.reduce((acc, cur) => acc += `<option value=\"${cur.type}\" ${cur.s}>${cur.name}</option>`,\"\");\nconst content = `<form><div class=\"form-group\"><label>Damage Type:</label><select>${options}</select></div></form>`;\n\nconst d = Dialog.prompt({\n\ttitle: \"Chromatic Orb: Usage Configuration\",\n\tcontent,\n\tlabel: \"Ok\",\n\tcallback: html => {\n\t\tconst selectedDamageType = html[0].querySelector(\"select\").value;\n\t\tlet newDamage = duplicate(spell.data.data.damage);\n\t\tnewDamage.parts[0][1] = selectedDamageType;\n\t\tspell.update({\"data.damage\": newDamage});\n\t\tspell.roll();\n\t},\n\trender: html => html.find(\"select\").focus(),\n\trejectClose: false\n});","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.wL6QZ29r2k96wwKC"}}}
{"_id":"irDJs8yGv7JRrIEh","name":"Agua Doce","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/consumables/potions/bottle-conical-corked-labeled-shell-cyan.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Agua Doce\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"}}}
{"_id":"ldJhtugNLLLBqDMC","name":"#[CF_tempEntity]","type":"chat","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"cf":{"id":"temp_9kjle51osdj","path":"DAE","color":"#800000","name":"DAE","children":[null],"folderPath":[]}}}
{"_id":"lw93Q7h157TcG6JI","name":"#[CF_tempEntity]","type":"chat","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"cf":{"id":"temp_31qb6b5fb3x","name":"Players Folder","color":"#000000","folderPath":[],"children":[]}}}
{"_id":"pbPTVpFI3eu9TKFD","name":"Hypnotic Pattern 1","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/air/air-burst-spiral-pink.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Hypnotic Pattern\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"}}}
{"name":"Update tokens to Actor","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"(async () => {\n  let updates = canvas.scene.data.tokens.map(t => {\n    let tactor = game.actors.entities.find(a => a.name === t.name);\n        if (tactor) {\n            return {\n                _id: t._id,\n                actorId: tactor.id\n            }\n        } else {\n            console.log(t.name);\n            return {\n                _id: t._id,\n                actorId: \"\"\n            }\n        }\n  });\n  await canvas.scene.updateEmbeddedEntity(\"Token\", updates);\n})();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_1obgq4p2j0q","path":"Generators","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.P1yN1NvtrlEiVUAi"}},"_id":"pfamJ7hkUvTBrCzL"}
{"name":"#[CF_tempEntity]","type":"chat","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"cf":{"id":"temp_1z2ppbh1u8p","path":"Automação Master","color":"#0080ff","name":"Automação Master","children":["7qNAt7Vx40y63bd3","IuvO6w3YtJmjUGcf","gNukDjiPOdBAEXU1","Or6VL0dO08ZrSvU5","JozN50QPQYV8A2i6","dkpT9wpKh8ZICAd5","bJFiyTFwdbqsuIkg","5bl99S0mf8q6keOO"],"folderPath":[]}},"_id":"priS5T7OM5kOZ8Lb"}
{"_id":"qvX5UbHcNuBSh3IX","name":"Fireball","type":"script","author":"DPSwXpPVU8d93GBw","img":"modules/plutonium/media/icon/spell/phb-fireball.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Fireball\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.9UCXHdm3z1mGhB0P"}}}
{"_id":"rPvuSeJV9GD4f0o7","name":"Visitar","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/environment/settlement/house-farmland-small.webp","scope":"global","command":"let visitar = InnocentiWorld.Visitar();","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"macro-marker":{"activeData":{"icon":"icons/svg/hanging-sign.svg","tooltip":"Visitar","colour":"#80ff80","trigger":""}},"cf":{"id":"temp_3rrfyxwmoc3","path":"Player Macros","color":"#e4950c"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.AN84WHe2g38no7vo"}}}
{"name":"Update Cite Journal","type":"script","author":"7qbBJORkk2z0FBTX","img":"icons/svg/dice-target.svg","scope":"global","command":"const actorNames = game.actors.map(actor => actor.name).filter((value, index, self) => self.indexOf(value) === index);\nconst journalNames = game.journal.map(journal => journal.name).filter((value, index, self) => self.indexOf(value) === index);\n\nconst indexCite = {\n    Actor: actorNames,\n    JournalEntry: journalNames\n    }\n\ngame.journal.forEach(entry => {\n    //console.log(entry.entity)\n    if(entry.folder !== null && entry.folder.name !== \"UPDATE\") return;\n    let newcontent = entry.data.content;\n    for(const [key, value] of Object.entries(indexCite)){\n        let entityType = key;\n        for (let i = 0; i < value.length; i++) {\n            let strName = value[i];\n            let str = `(?!\\\\[)\\\\b${strName}\\\\b(?![\\\\w\\\\s]*[\\\\]\\\\}])`;\n            //let str = `\\\\b${strName}(?=[^\\\\}\\\\]\\\\w])`;\n            let regEx = new RegExp(str, 'g');\n            if(value[i] != entry.name){\n                //console.log(regEx);\n                if(newcontent == null) return;\n                newcontent = newcontent.replace(regEx, `@${entityType}[${value[i]}]{${value[i]}}`);\n            }else{\n               newcontent = newcontent.replace(regEx, `<strong>${value[i]}</strong>`); \n            }\n        }\n        //console.log(newcontent);\n        entry.update({ content: newcontent });\n    }\n    //console.log(newcontent);\nui.notifications.info(\"Atualizou as citações nos journals\")\n    console.log(\"FIM\");\n});\nfunction escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}","folder":null,"sort":0,"permission":{"default":0,"7qbBJORkk2z0FBTX":3},"flags":{"furnace":{"runAsGM":false},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"Update Cite Journal","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_1obgq4p2j0q","path":"Generators","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-actions.automation-macros.aJos5nKyMzGXkg0Y"}},"_id":"sfwIdnImby8sxWfa"}
{"_id":"uSXDd61Ow6akFP4X","name":"Potion of Healing","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/consumables/potions/potion-tube-corked-red.webp","scope":"global","command":"game.dnd5e.rollItemMacro(\"Potion of Healing\");","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.KPbk3tCRp3u9xoeW"}}}
{"_id":"v53Q7DSVm8NUy2EW","name":"Metamagic: Empowered Spell","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/lightning/bolt-strike-explosion-blue.webp","scope":"global","command":"const feat = actor?.items.find(i => i.name === \"Metamagic: Empowered Spell\");\nconst resource = actor?.items.find(i => i.name === \"Sorcery Points\");\nif ( !feat || !resource ) return ui.notifications.warn(\"Feature not found.\");\n\nconst diceSizes = [{size:\"4\",s:\"\"},{size:\"6\",s:\"selected\"},{size:\"8\",s:\"\"},{size:\"10\",s:\"\"},{size:\"12\",s:\"\"}];\nconst options = diceSizes.reduce((acc, cur) => acc += `<option value=\"${cur.size}\" ${cur.s}>d${cur.size}</option>`,\"\");\nconst content = `<form style=\"text-align:center\">\n\t\t\t\t\t<label>Dice Size:</label>\n\t\t\t\t\t<select>${options}</select>\n\t\t\t\t\t<div style=\"display:inline-block; width:5px\"></div>\n\t\t\t\t\t<label>Original Rolls:</label>\n\t\t\t\t\t<input name=\"roll1\" type=\"number\" style=\"width:40px\"/>\n\t\t\t\t\t<input name=\"roll2\" type=\"number\" style=\"width:40px\"/>\n\t\t\t\t\t<input name=\"roll3\" type=\"number\" style=\"width:40px\"/>\n\t\t\t\t\t<input name=\"roll4\" type=\"number\" style=\"width:40px\"/>\n\t\t\t\t</form>`;\n\nnew Dialog({\n\ttitle: \"Empowered Spell: Usage Configuration\",\n\tcontent,\n\tbuttons: {\n\t\tEmpower_0: {\n\t\t\ticon: `<i class=\"fas fa-minus\"></i>`,\n\t\t\tlabel: \"Empower: 0\",\n\t\t\tcallback: html => {\n\t\t\t\tconst diceSize = html.find(\"select\").val();\n\t\t\t\tconst rolls = html.find(\"input\").serializeArray();\n\t\t\t\tconst expend = false;\n\t\t\t\tempower(diceSize, rolls, expend);\n\t\t\t}\n\t\t},\n\t\tEmpower_1: {\n\t\t\ticon: `<i class=\"fas fa-dice-d20\"></i>`,\n\t\t\tlabel: \"Empower: 1\",\n\t\t\tcallback: html => {\n\t\t\t\tif ( resource.data.data.uses.value < 1 ) return ui.notifications.warn(\"Not enough Sorcery Points.\");\n\t\t\t\tconst diceSize = html.find(\"select\").val();\n\t\t\t\tconst rolls = html.find(\"input\").serializeArray();\n\t\t\t\tconst expend = true;\n\t\t\t\tempower(diceSize, rolls, expend);\n\t\t\t}\n\t\t}\n\t},\n\trender: html => html.find(\"select\").focus(),\n\tdefault: \"Empower_1\"\n}).render(true);\n\nasync function empower(diceSize, rolls, expend) {\n\tlet dicesRolled = 0, rollTotal = 0, rollString = \"\", error = false;\n\n\tfor ( let entry of rolls ) {\n\t\tconst roll = parseInt(entry.value);\n\t\tif ( roll || roll === 0 ) {\n\t\t\tif ( roll < 1 || roll > parseInt(diceSize) ) {\n\t\t\t\terror = true;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tdicesRolled++;\n\t\t\t\trollTotal += roll;\n\t\t\t\tlet rollRank;\n\t\t\t\tif ( roll === 1 ) rollRank = \"min\";\n\t\t\t\tif ( roll == diceSize ) rollRank = \"max\";\n\t\t\t\trollString += `<span class=\"roll d${diceSize} ${rollRank}\" style=\"margin-bottom:5px\">${roll}</span>`;\n\t\t\t}\n\t\t}\n\t}\n\n\tif ( !dicesRolled || error ) return ui.notifications.warn(\"Please insert valid roll numbers.\");\n\tif ( expend ) {\n\t\tresource.update({\"data.uses.value\": resource.data.data.uses.value - 1});\n\t\tawait feat.roll();\n\t}\n\tnew Roll(`${dicesRolled}d${diceSize} - ${rollTotal}`).toMessage({\n\t\t\tspeaker: {alias: \"Fëanor - Empowered Spell\"},\n\t\t\tflavor: `<div class=\"dice-roll\"><div class=\"dice-formula\" style=\"font-size:14px; color:#191813\">Spent ${expend ? 1 : 0} SP to Reroll:</div></div>\n\t\t\t\t\t<span class=\"dice-tooltip\"><span class=\"dice-rolls\">${rollString}</span></span>`\n\t\t});\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000"},"core":{"sourceId":"Compendium.innocenti-worlds.macros-houserules.Rb91AM5d89oBUl2a"}}}
{"name":"#[CF_tempEntity]","type":"chat","author":"DPSwXpPVU8d93GBw","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"cf":{"id":"temp_g8nbvfatngj","path":"Players Folder#/CF_SEP/Paulo","color":"#000000","name":"Paulo","children":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"folderPath":["temp_31qb6b5fb3x"]}},"_id":"xmmvjUoB9g1i2VWp"}
{"_id":"zDnUqynFzGcx2uK2","name":"RecoveryExhaustian","type":"script","author":"DPSwXpPVU8d93GBw","img":"icons/magic/life/crosses-trio-red.webp","scope":"global","command":"console.log(\"potion\",args)\n//const lastArg = args[args.length-1];\nlet target = MidiQOL.MQFromUuid(args[0].tokenUuid);\nlet recovery = parseInt(args[0].itemData.data.formula);\nlet exha = parseInt(target.actor.data.data.attributes.exhaustion);\nif(args[0].tag == \"OnUse\"){\n    console.log(\"rest\",exha, recovery)\n   if(recovery != 0){\n       exha = ((exha - recovery) < 0)?0:(exha - recovery);\n   }else{\n       exha = 0; \n   }\n   console.log(\"rest2\",exha, target)\n   await target.actor.update({\"data.attributes.exhaustion\":exha});\n}","folder":null,"sort":0,"permission":{"default":0,"DPSwXpPVU8d93GBw":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"scene-packer":{"sourceId":"Macro.zDnUqynFzGcx2uK2"},"cf":{"id":"temp_9kjle51osdj","path":"DAE","color":"#800000"}}}
