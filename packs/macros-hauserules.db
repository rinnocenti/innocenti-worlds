{"name":"Edit Biografy in Compendium","permission":{"default":0,"hfVBUA9x0nVqLlXX":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"let packname = \"innocenti-worlds.npcs\";\r\nlet pack = game.packs.get(packname);\r\nlet cpack = await pack.getContent();\r\ngame.actors.forEach(entry => {\r\nlet bio = entry.data.data.details.biography;\r\nlet matches = bio.value.replace(/mod-my-world/g, 'innocenti-worlds');\r\n//console.log(matches );\r\nentry.update({ 'data.details.biography.value' : matches }); \r\n})\r\nconsole.log(\"FIM\");","author":"hfVBUA9x0nVqLlXX","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"12k8l8iqr7VvImRX"}
{"name":"SeeID","permission":{"default":0,"bE4FsemgBF2CPXB2":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"//Display Name & IDs\r\nfor(let token of canvas.tokens.controlled)\r\n{\r\n    ChatMessage.create({\r\n        content : token.name + \" \" + token.id\r\n    });\r\n}\r\n\r\nfor(let wall of canvas.walls.controlled)\r\n{\r\n    ChatMessage.create({\r\n        content : wall.name + \" \" + wall.id\r\n    })\r\n}\r\n/*\r\nfor(let light of canvas.lighting.activate)\r\n{\r\n    ChatMessage.create({\r\n        content : light.name + \" \" + light.id\r\n    })\r\n}\r\nfor (let note of canvas.notes.placeables)\r\n{\r\n    ChatMessage.create({\r\n        content :  note.name + \" \" + note.id\r\n     });\r\n}\r\n*/\r\nfor (let draw of canvas.drawings.controlled)\r\n{\r\n   ChatMessage.create({\r\n      content :  draw.name + \" \" + draw.id\r\n   });\r\n}\r\n\r\nfor (let tile of canvas.tiles.controlled)\r\n{\r\n    ChatMessage.create({\r\n        content :  tile.name + \" \" + tile.id\r\n     });\r\n}","author":"bE4FsemgBF2CPXB2","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"5g5M5rzPz0K6E42w"}
{"name":"Actor Update ID to names","permission":{"default":0,"oYLBQUHyYQcwtcvC":3},"type":"script","flags":{"furnace":{"runAsGM":true}},"scope":"global","command":"game.journal.forEach(entry => {\r\n  let content = entry.data.content;\r\n  let matches = content.match(/@\\w*\\[([0-9A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ.\\- ]+)\\]/g);\r\n  \r\n  // now we have an array of things such as @Actor[5c8HWfrpvRV4XtZ1]\r\n  if(matches == null) return;\r\n  let newcontent = content;\r\n  let uniqueMatches = matches\r\n    .filter((value, index, self) => self.indexOf(value) === index) //unique matches\r\n    .forEach(str => {\r\n      let arrayData = str.slice(1, -1).split('['); // cut off the @ and ] then make [0] the type and [1] the id.\r\n      // since the reference may not match directly with the game entity type, lets look that up.\r\n      //console.log(arrayData)\r\n      let entityType = getEntityType(arrayData[0]);\r\n      let packname;\r\n      if(entityType == 'packs'){\r\n       let pck =  arrayData[1].split('.');\r\n       packname = `${pck[0]}.${pck[1]}`;\r\n       arrayData[1] = pck[2];\r\n      }\r\n      let id = arrayData[1];\r\n      let name;\r\n      // with the id and our entity type, look up the name of the entry.\r\n      if(entityType == 'packs'){\r\n          let packs = game[entityType].get(packname);\r\n          let pindex = packs.index.find(element => element._id === id) || packs.index.find(element => element.name === id);\r\n          //console.log(packs);\r\n          if(!pindex)\r\n            return ui.notifications.error(`Could not find any record for the entity type ${entityType} in pack ${packs.name} with the id of ${id}`);\r\n          name = pindex.name;\r\n      }else{\r\n          name = game[entityType].get(id)?.name;\r\n      }\r\n      //console.log(name)\r\n      if (!name) {\r\n        return ui.notifications.error(`Could not find any record for the entity type ${entityType} with the id of ${arrayData[0]}`);\r\n      }\r\n\r\n      // replace the ID with the name.\r\n      console.log(`updating ${id} with ${name}`);\r\n\r\n      let regEx = new RegExp(id, 'g');\r\n      newcontent = newcontent.replace(regEx, name);\r\n      //console.log(newcontent)\r\n    }); \r\n  entry.update({ content: newcontent });\r\n});\r\n\r\nfunction getEntityType(entity) {\r\n  switch (entity) {\r\n    case 'JournalEntry': return 'journal';\r\n    case 'RollTable': return 'tables';\r\n    case 'Compendium': return 'packs';\r\n    default: return entity.toLowerCase() + 's';\r\n  }\r\n}","author":"oYLBQUHyYQcwtcvC","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"D6SIWJbVHF0f7aBs"}
{"name":"Edit Compendiums","permission":{"default":0,"hfVBUA9x0nVqLlXX":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"let packname = \"innocenti-worlds.handout\";\r\n//let newpackname = \"innocenti-worlds.citys\";\r\n//let oldpackname = \"mod-my-world.citys\";\r\n\r\nlet pack = game.packs.get(packname);\r\nlet cpack = await pack.getContent();\r\ncpack.forEach(entry => {\r\nlet content = entry.data.content;\r\n//let matches = content.match(/@\\w*\\[([\\w.-]+)\\]\\{([\\w.-\\s]+)\\}/g);\r\n//var newstring = content.replace(/(mod[-]my[-]world)/, \"innocenti-worlds\");\r\n//newstring = newstring.replace(\"mod-my-world.locals\", \"innocenti-worlds.locals\");\r\nlet matches = content.replace(/mod-my-world/g, 'innocenti-worlds');\r\nentry.update({ content:  matches}); \r\n})\r\n\r\nawait console.log(\"FIM\");\r\n\r\n","author":"hfVBUA9x0nVqLlXX","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"IEhvAtNQo7hIBUTv"}
{"name":"Update Cite Journal","permission":{"default":0,"oYLBQUHyYQcwtcvC":3},"type":"script","flags":{"furnace":{"runAsGM":false}},"scope":"global","command":"const actorNames = game.actors.map(actor => actor.name).filter((value, index, self) => self.indexOf(value) === index);\r\nconst journalNames = game.journal.map(journal => journal.name).filter((value, index, self) => self.indexOf(value) === index);\r\n\r\nconst indexCite = {\r\n    Actor: actorNames,\r\n    JournalEntry: journalNames\r\n    }\r\n\r\ngame.journal.forEach(entry => {\r\n    //console.log(entry.entity)\r\n    let newcontent = entry.data.content;\r\n    for(const [key, value] of Object.entries(indexCite)){\r\n        let entityType = key;\r\n        for (let i = 0; i < value.length; i++) {\r\n            let strName = value[i];\r\n            let str = `(?!\\\\[)\\\\b${strName}\\\\b(?![\\\\w\\\\s]*[\\\\]\\\\}])`;\r\n            //let str = `\\\\b${strName}(?=[^\\\\}\\\\]\\\\w])`;\r\n            let regEx = new RegExp(str, 'g');\r\n            if(value[i] != entry.name){\r\n                //console.log(regEx);\r\n                newcontent = newcontent.replace(regEx, `@${entityType}[${value[i]}]{${value[i]}}`);\r\n            }else{\r\n               newcontent = newcontent.replace(regEx, `<strong>${value[i]}</strong>`); \r\n            }\r\n        }\r\n        //console.log(newcontent);\r\n        entry.update({ content: newcontent });\r\n    }\r\n    //console.log(newcontent);\r\n    console.log(\"FIM\");\r\n});\r\nfunction escapeRegExp(string) {\r\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\r\n}","author":"oYLBQUHyYQcwtcvC","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"Io6kAw1BSkK3mE50"}
{"name":"Remove Flags","permission":{"default":0,"oYLBQUHyYQcwtcvC":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"for (let t of canvas.tokens.placeables) {\r\nif(t.getFlag(`world`, `worldTrigger`))\r\n        await t.unsetFlag(`world`, `worldTrigger`);\r\n}\r\nawait console.log(\"Fim dos tokens\");\r\nawait console.log(canvas.tokens.controlled[0].data.flags);\r\nfor (let t of game.users) {\r\nif(t.getFlag(`world`, `worldTrigger`))\r\n        await t.unsetFlag(`world`, `worldTrigger`);\r\n}\r\nawait console.log(\"Fim dos usuários\");\r\nawait console.log(game.user.data.flags);","author":"oYLBQUHyYQcwtcvC","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"OyRBjXCnTLP2Oie2"}
{"_id":"QXuPIQKeXtB9zP1U","name":"Import from Compendium","permission":{"default":0,"hfVBUA9x0nVqLlXX":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"/**\r\n * Macro that will create a Folder with same name of Compendium,\r\n * then import entire compendium into created folder\r\n *\r\n * Thanks to Atropos for optimizing import\r\n *\r\n * @author Forien#2130\r\n * @url https://patreon.com/forien\r\n * @author Atropos\r\n * @licence MIT\r\n */\r\n// provide identifier of compendium. Use F12->Inspect Tool if necessary\r\n\r\nlet packOptions = game.packs.map(pack => `<option value=\"${pack.collection}\">${pack.title}</option>`);\r\n\r\nconst form = `\r\n  <div style=\"display: inline-block; width: 100px\">Compendium:</div>\r\n  <select id=\"destinationPack\" />\r\n    ${packOptions}\r\n  </select>\r\n  <br />\r\n`;\r\nconst dialog = new Dialog({\r\n    title: \"Import Compendium in folder\",\r\n    content: form,\r\n    buttons: {\r\n        use: {\r\n            label: \"Apply\",\r\n            callback: importPack\r\n        }\r\n    }\r\n}).render(true);\r\n\r\n\r\nasync function importPack(html) {\r\n    const packName = html.find(`select#destinationPack`)[0].value;\r\n    const pack = game.packs.get(packName);\r\n    const entity = pack.entity;\r\n    const entityClass = CONFIG[entity].entityClass;\r\n\r\n    const content = await pack.getContent();\r\n    const folder = await Folder.create({ name: pack.metadata.label, type: entity, parent: null });\r\n    const createData = content.map(c => {\r\n        c.data.folder = folder._id;\r\n        return c.data;\r\n    });\r\n\r\n    return entityClass.create(createData);\r\n}","author":"hfVBUA9x0nVqLlXX","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"Fix Actors (change compendium links)","permission":{"default":0,"oYLBQUHyYQcwtcvC":3},"type":"script","flags":{"furnace":{"runAsGM":true}},"scope":"global","command":"//TROCA OS LINKS DE COMPENDIUM PARA LINKS DO MUNDO.\r\n// COM ECXESSÃO DOS ITEMS QUE MANTÉM NO COMPENDIUM\r\ngame.actors.forEach(entry => {\r\n    let content = entry.data.data.details.biography.value;\r\n    let matches = content.match(/@\\w*\\[([0-9A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ.\\- ]+)\\]?(\\{([0-9A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ;&.\"()\\- ]+)\\})/g);\r\n\r\n    // now we have an array of things such as @Actor[5c8HWfrpvRV4XtZ1]\r\n    if (matches == null) return;\r\n    let newcontent = content;\r\n    let uniqueMatches = matches\r\n        .filter((value, index, self) => self.indexOf(value) === index) //unique matches\r\n        .forEach(str => {\r\n            let firstdata = str.slice(0, -1).split('{');\r\n            let pName = firstdata[1];\r\n            //console.log(firstdata);\r\n            let arrayData = firstdata[0].slice(1, -1).split('['); // cut off the @ and ] then make [0] the type and [1] the id.\r\n            // since the reference may not match directly with the game entity type, lets look that up.\r\n            //console.log(arrayData, pName)\r\n            if (arrayData[0] != 'Compendium') return;\r\n            let pck = arrayData[1].split('.');\r\n            let packname = `${pck[0]}.${pck[1]}`;\r\n            //console.log(packname);\r\n            let id = pck[2];\r\n            let entityType = getEntityType(arrayData[0]);\r\n            \r\n            // with the id and our entity type, look up the name of the entry.\r\n            let packs = game[entityType].get(packname);\r\n            \r\n            if(packs == null){ return console.log(`Não Existe Um compendium com o nome: ${packname} com o item ${entry.name}`)}\r\n            let newEntity = packs.entity;\r\n            //console.log(newEntity);\r\n            if (newEntity === 'Item') return;\r\n            let pindex = packs.index.find(element => element._id === id) || packs.index.find(element => element.name === pName);\r\n            \r\n            if (!pindex) {\r\n                //console.log(packs.index.find(element => element.name == pName), pName, newEntity, packname);\r\n                //return ui.notifications.error(`Could not find any record for the entity type ${entityType} in pack ${packs} with the id of ${id}`);\r\n            }\r\n            let name = (pindex) ? pindex.name : htmlDecode(pName);\r\n            //console.log(name);\r\n\r\n            if (!name) {\r\n                return ui.notifications.error(`Could not find any record for the entity type ${entityType} with the id of ${arrayData[0]}`);\r\n            }\r\n            let changeEntry = (name !== '') ? `@${packs.entity}[${name}]` : '';\r\n            //console.log(changeEntry);\r\n            let newstr = escapeRegExp(firstdata[0]);\r\n            console.log(`updating ${id} with ${name}`);\r\n            let regEx = new RegExp(newstr, 'g');\r\n            //console.log(regEx);\r\n            newcontent = newcontent.replace(regEx, changeEntry);\r\n            //console.log(newcontent);\r\n        });\r\n    entry.update({ 'data.details.biography.value': newcontent });\r\n});\r\nconsole.log(\"FIM\");\r\n\r\nfunction escapeRegExp(string) {\r\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\r\n}\r\nfunction getEntityType(entity) {\r\n    switch (entity) {\r\n        case 'JournalEntry': return 'journal';\r\n        case 'RollTable': return 'tables';\r\n        case 'Compendium': return 'packs';\r\n        default: return entity.toLowerCase() + 's';\r\n    }\r\n}\r\nfunction htmlDecode(input) {\r\n  var doc = new DOMParser().parseFromString(input, \"text/html\");\r\n  return doc.documentElement.textContent;\r\n}","author":"oYLBQUHyYQcwtcvC","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"XM4Q96Ue8YW8MO95"}
{"name":"Update Tiles","permission":{"default":0,"hfVBUA9x0nVqLlXX":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"let addr = \"assets/scenes/background/\";\r\nfor (let tiles of canvas.tiles.placeables) {\r\nlet oldimg = tiles.data.img;\r\nvar newstring = oldimg.replace(\"modules/mod-my-world/assets/scenes/background/\", addr);\r\nconsole.log(newstring);\r\ntiles.update({img:`${newstring}`});\r\n}\r\n//canvas.tiles.placeables[0].update({img:\"assets/scenes/background/The_Dessarin_Valley/tile_31.png\"})","author":"hfVBUA9x0nVqLlXX","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"dK5JNJJ3FXnhjCsJ"}
{"name":"Update Cite e Bio","permission":{"default":0,"oYLBQUHyYQcwtcvC":3},"type":"script","flags":{"furnace":{"runAsGM":false}},"scope":"global","command":"const actorNames = game.actors.map(actor => actor.name).filter((value, index, self) => self.indexOf(value) === index);\r\nconst journalNames = game.journal.map(journal => journal.name).filter((value, index, self) => self.indexOf(value) === index);\r\n\r\nconst indexCite = {\r\n    Actor: actorNames,\r\n    JournalEntry: journalNames\r\n    }\r\n\r\ngame.actors.forEach(entry => {\r\n    //console.log(entry.entity)\r\n    let newcontent = entry.data.data.details.biography.value;\r\n    for(const [key, value] of Object.entries(indexCite)){\r\n        let entityType = key;\r\n        for (let i = 0; i < value.length; i++) {\r\n            if(value[i] != entry.name){\r\n            //let strName = escapeRegExp(value[i]);\r\n            let str = `(?!\\\\[)\\\\b${value[i]}\\\\b(?![\\\\w\\\\s]*[\\\\]\\\\}])`;\r\n            //console.log(str);\r\n            let regEx = new RegExp(str, 'g');\r\n            if(value[i] != entry.name){\r\n                //console.log(regEx);\r\n                newcontent = newcontent.replace(regEx, `@${entityType}[${value[i]}]{${value[i]}}`);\r\n            }else{\r\n               newcontent = newcontent.replace(regEx, `<strong>${value[i]}</strong>`); \r\n            }}\r\n        }\r\n        //console.log(newcontent);\r\n        entry.update({ 'data.details.biography.value': newcontent });\r\n    }\r\n    console.log(\"FIM\");\r\n});\r\nfunction escapeRegExp(string) {\r\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\r\n}","author":"oYLBQUHyYQcwtcvC","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"eUdSjjf2U6Zthw0t"}
{"name":"Folder to Compendium","permission":{"default":0,"bE4FsemgBF2CPXB2":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"/**\r\n * Import folder into writable compendium. Locked compendiums will not show as an option.\r\n * Folder type is optional, however will help if you have the same folder name across multiple system types.\r\n * Also contains options to store subfolder contents, update existing records (or only add new), and delete duplicate records.\r\n * Author: KrishMero#1792\r\n */\r\n\r\nlet packOptions = game.packs.filter(pack => !pack.locked).map(pack => `<option value=\"${pack.collection}\">${pack.title}</option>`);\r\nlet entityType = COMPENDIUM_ENTITY_TYPES.map(type => `<option value=\"${type}\">${type}</option>`);\r\nconst form = `\r\n  <div style=\"display: inline-block; width: 100px\">Folder:</div>\r\n  <input type=\"string\" id=\"folderName\">\r\n  <br />\r\n\r\n  <div style=\"display: inline-block; width: 100px\">Folder Type:</div>\r\n  <select id=\"entityType\" />\r\n    <option value=\"\">--</option>\r\n    ${entityType}\r\n  </select>\r\n  <br />\r\n\r\n  <div style=\"display: inline-block; width: 100px\">Compendium:</div>\r\n  <select id=\"destinationPack\" />\r\n    ${packOptions}\r\n  </select>\r\n  <br />\r\n\r\n  <label>\r\n    <input type=\"checkbox\" id=\"recurse\" checked/>\r\n    Store subfolders too\r\n  </label>\r\n  <br />\r\n\r\n  <label>\r\n    <input type=\"checkbox\" id=\"update\" checked/>\r\n    Update existing records (unchecked = only add new)\r\n  </label>\r\n  <br />\r\n\r\n  <label>\r\n    <input type=\"checkbox\" id=\"delete\" checked/>\r\n    Delete duplicates\r\n  </label>\r\n`;\r\n\r\nconst dialog = new Dialog({\r\n  title: \"Store folder in compendium\",\r\n  content: form,\r\n  buttons: {\r\n    use: {\r\n      label: \"Apply\",\r\n      callback: storeFolder\r\n    }\r\n  }\r\n}).render(true);\r\n\r\nfunction storeFolder(html) {\r\n  const folderName = html.find(`input#folderName`)[0].value;\r\n  const folderType = html.find(`select#entityType`)[0].value;\r\n  const destinationPack = html.find(`select#destinationPack`)[0].value;\r\n  const recurse = html.find(`input#recurse`)[0].checked;\r\n  const update = html.find(`input#update`)[0].checked;\r\n  const deleteRecords = html.find(`input#delete`)[0].checked;\r\n  \r\n  let folders = game.folders.filter(f => f.name === folderName);\r\n  if (folderType) {\r\n    folders = folders.filter(f => f.type === folderType);\r\n  }\r\n  if (folders.length === 0) {\r\n    ui.notifications.error(`Your world does not have any folders named '${folderName}'.`);\r\n  }\r\n  else if(folders.length > 1) {\r\n    ui.notifications.error(`Your world has more than one folder named ${folderName}`) \r\n  }\r\n  else {\r\n    console.log(`storing in ${destinationPack}`);\r\n    let packObject = game.packs.get(destinationPack);\r\n    storeRecursively(folders[0], packObject, recurse, update, deleteRecords);\r\n    ui.notifications.notify(`'${folderName}' stored successfully in '${packObject.title}'.`);\r\n  }\r\n}\r\n\r\nfunction storeRecursively(currentFolder, packObject, recurse, update, deleteRecords) {\r\n  console.log('store recursively for ' + currentFolder.name);\r\n  if (currentFolder.content) {\r\n    currentFolder.content.map(item => {\r\n      console.debug(\"  Item:\", item.data.name);\r\n      let existingRecords = packObject.index.filter(i => i.name === item.data.name);\r\n      if (item.data.name === 'Augury') {\r\n        console.log(existingRecords);\r\n        console.log(existingRecords.length);\r\n      }\r\n\r\n      // Delete all but the first duplicate.\r\n      if(existingRecords.length > 1) {\r\n        if (deleteRecords) {\r\n          console.log(existingRecords);\r\n          existingRecords.shift();\r\n          existingRecords.map(record => packObject.deleteEntity(record._id));\r\n        } else {\r\n          console.log(`Skipped: ${existingRecords[0].name}`)\r\n          ui.notifications.error(`Can't store '${existingRecords[0].name}' as multiple records were found. Delete the extras or check 'Delete duplicates'. Logged to console.`);\r\n        }\r\n      }\r\n\r\n      if (existingRecords.length === 1 && update) {\r\n        packObject.updateEntity(existingRecords[0]);\r\n      } else if (!existingRecords.length) {\r\n        packObject.createEntity(item);\r\n      }\r\n      \r\n    });\r\n  }\r\n\r\n  if (currentFolder.children && recurse) {\r\n    currentFolder.children.map(({ data }) => {\r\n      storeRecursively(\r\n        game.folders.entities.filter(f => f.data._id == data._id)[0],\r\n        packObject,\r\n        recurse, \r\n        update,\r\n        deleteRecords\r\n      );\r\n    });\r\n  }\r\n}","author":"bE4FsemgBF2CPXB2","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"hNUyZeNQwLCqMa1c"}
{"name":"Fix Journals (change compendium links)","permission":{"default":0,"oYLBQUHyYQcwtcvC":3},"type":"script","flags":{"furnace":{"runAsGM":true}},"scope":"global","command":"//TROCA OS LINKS DE COMPENDIUM PARA LINKS DO MUNDO.\r\n// COM ECXESSÃO DOS ITEMS QUE MANTÉM NO COMPENDIUM\r\nlet count = 0;\r\ngame.journal.forEach(entry => {\r\n    let content = entry.data.content;\r\n    let matches = content.match(/@\\w*\\[([0-9A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ.\\- ]+)\\]?(\\{([0-9A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ;&.\"()\\- ]+)\\})/g);\r\n\r\n    // now we have an array of things such as @Actor[5c8HWfrpvRV4XtZ1]\r\n    if (matches == null) return;\r\n    let newcontent = content;\r\n    \r\n    let uniqueMatches = matches\r\n        .filter((value, index, self) => self.indexOf(value) === index) //unique matches\r\n        .forEach(str => {\r\n            count++;\r\n            let firstdata = str.slice(0, -1).split('{');\r\n            let pName = firstdata[1];\r\n            //console.log(firstdata);\r\n            let arrayData = firstdata[0].slice(1, -1).split('['); // cut off the @ and ] then make [0] the type and [1] the id.\r\n            // since the reference may not match directly with the game entity type, lets look that up.\r\n            //console.log(arrayData, pName)\r\n            if (arrayData[0] != 'Compendium') return;\r\n            let pck = arrayData[1].split('.');\r\n            let packname = `${pck[0]}.${pck[1]}`;\r\n            //console.log(packname);\r\n            let id = pck[2];\r\n            let entityType = getEntityType(arrayData[0]);\r\n            \r\n            // with the id and our entity type, look up the name of the entry.\r\n            let packs = game[entityType].get(packname);\r\n            \r\n            if(packs == null){ return console.log(`Não Existe Um compendium com o nome: ${packname} com o item ${entry.name}`)}\r\n            let newEntity = packs.entity;\r\n            //console.log(newEntity);\r\n            if (newEntity === 'Item') return;\r\n            let pindex = packs.index.find(element => element._id === id) || packs.index.find(element => element.name === pName);\r\n            \r\n            if (!pindex) {\r\n                //console.log(packs.index.find(element => element.name == pName), pName, newEntity, packname);\r\n                //return ui.notifications.error(`Could not find any record for the entity type ${entityType} in pack ${packs} with the id of ${id}`);\r\n            }\r\n            let name = (pindex) ? pindex.name : htmlDecode(pName);\r\n            console.log(name);\r\n\r\n            if (!name) {\r\n                return ui.notifications.error(`Could not find any record for the entity type ${entityType} with the id of ${arrayData[0]}`);\r\n            }\r\n            let changeEntry = (name !== '') ? `@${packs.entity}[${name}]` : '';\r\n            //console.log(changeEntry);\r\n            let newstr = escapeRegExp(firstdata[0]);\r\n            console.log(`updating ${id} with ${name}`);\r\n            let regEx = new RegExp(newstr, 'g');\r\n            //console.log(regEx);\r\n            newcontent = newcontent.replace(regEx, changeEntry);\r\n            //console.log(newcontent);\r\n        });\r\n    entry.update({ content: newcontent });\r\n});\r\nconsole.log(count);\r\n\r\nfunction escapeRegExp(string) {\r\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\r\n}\r\nfunction getEntityType(entity) {\r\n    switch (entity) {\r\n        case 'JournalEntry': return 'journal';\r\n        case 'RollTable': return 'tables';\r\n        case 'Compendium': return 'packs';\r\n        default: return entity.toLowerCase() + 's';\r\n    }\r\n}\r\n\r\nfunction htmlDecode(input) {\r\n  var doc = new DOMParser().parseFromString(input, \"text/html\");\r\n  return doc.documentElement.textContent;\r\n}","author":"oYLBQUHyYQcwtcvC","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"jzLZKAYBAimx2b9W"}
{"name":"Journals Update ID to names","permission":{"default":0,"oYLBQUHyYQcwtcvC":3},"type":"script","flags":{"furnace":{"runAsGM":true}},"scope":"global","command":"game.journal.forEach(entry => {\r\n  let content = entry.data.content;\r\n  let matches = content.match(/@\\w*\\[([0-9A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ.\\- ]+)\\]/g);\r\n  \r\n  // now we have an array of things such as @Actor[5c8HWfrpvRV4XtZ1]\r\n  if(matches == null) return;\r\n  let newcontent = content;\r\n  let uniqueMatches = matches\r\n    .filter((value, index, self) => self.indexOf(value) === index) //unique matches\r\n    .forEach(str => {\r\n      let arrayData = str.slice(1, -1).split('['); // cut off the @ and ] then make [0] the type and [1] the id.\r\n      // since the reference may not match directly with the game entity type, lets look that up.\r\n      //console.log(arrayData)\r\n      let entityType = getEntityType(arrayData[0]);\r\n      let packname;\r\n      if(entityType == 'packs'){\r\n       let pck =  arrayData[1].split('.');\r\n       packname = `${pck[0]}.${pck[1]}`;\r\n       arrayData[1] = pck[2];\r\n      }\r\n      let id = arrayData[1];\r\n      let name;\r\n      // with the id and our entity type, look up the name of the entry.\r\n      if(entityType == 'packs'){\r\n          let packs = game[entityType].get(packname);\r\n          let pindex = packs.index.find(element => element._id === id) || packs.index.find(element => element.name === id);\r\n          //console.log(packs);\r\n          if(!pindex)\r\n            return ui.notifications.error(`Could not find any record for the entity type ${entityType} in pack ${packs.name} with the id of ${id}`);\r\n          name = pindex.name;\r\n      }else{\r\n          name = game[entityType].get(id)?.name;\r\n      }\r\n      //console.log(name)\r\n      if (!name) {\r\n        return ui.notifications.error(`Could not find any record for the entity type ${entityType} with the id of ${arrayData[0]}`);\r\n      }\r\n\r\n      // replace the ID with the name.\r\n      console.log(`updating ${id} with ${name}`);\r\n\r\n      let regEx = new RegExp(id, 'g');\r\n      newcontent = newcontent.replace(regEx, name);\r\n      //console.log(newcontent)\r\n    }); \r\n  entry.update({ content: newcontent });\r\n});\r\n\r\nfunction getEntityType(entity) {\r\n  switch (entity) {\r\n    case 'JournalEntry': return 'journal';\r\n    case 'RollTable': return 'tables';\r\n    case 'Compendium': return 'packs';\r\n    default: return entity.toLowerCase() + 's';\r\n  }\r\n}","author":"oYLBQUHyYQcwtcvC","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"qJncCezSSAFTtpkD"}
{"name":"Create Tables By Rarity","permission":{"default":0,"XH24HWwqaZhSywRV":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"game.betterTables.createTableFromCompendium(\"Full Table Fishs\",\r\n    //\"dnd5e.items\",\r\n    \"mod-my-world.item-foods\",\r\n    { weightPredicate: predicate }\r\n);\r\n\r\nfunction predicate(entity) {\r\n    if(entity.type != \"loot\") return 0;\r\n    //if(entity.data.data.consumableType != \"food\") return 0;\r\n    if(entity.data.data.source != \"Fish\") return 0;\r\n    switch (entity.data.data.rarity) {\r\n        case \"Common\":\r\n            return 16;\r\n        case \"Uncommon\":\r\n            return 8;\r\n        case \"Rare\":\r\n            return 4;\r\n        case \"Very rare\":\r\n            return 2;\r\n        case \"Legendary\":\r\n            return 1;\r\n        default:\r\n            return 0;\r\n    }\r\n}","author":"XH24HWwqaZhSywRV","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"uqhL0gLIVUzjDden"}
